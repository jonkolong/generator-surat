<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Domain Desa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; }
        .preview-area .page { background: white; padding: 2cm; margin-bottom: 2rem; box-shadow: 0 0 10px rgba(0,0,0,0.1); page-break-after: always; }
        .page:last-child { page-break-after: avoid; }
        .header-text h5, .header-text p { margin-bottom: 0; line-height: 1.2; }
        .letter-table td { vertical-align: top; padding-right: 10px; }
        .signature-block p { margin-bottom: 0; }
        .preserve-lines { white-space: pre-line; }
        .underline { text-decoration: underline; }

        @media print {
            /* Aturan untuk halaman cetak itu sendiri */
            @page {
                size: A4;
                margin: 2cm; /* Margin standar untuk dokumen resmi */
            }

            /* Sembunyikan semua elemen yang tidak perlu dicetak */
            .form-area, .no-print, header, footer, .navbar {
                display: none !important;
            }

            /* Atur ulang body dan pastikan font sesuai untuk dicetak */
            body {
                background: white !important; /* Hilangkan background gradient */
                font-size: 12pt; /* Ukuran font standar untuk dokumen */
                font-family: 'Arial', serif; /* Font formal untuk surat */
                color: black;
            }
            
            /* Pastikan area pratinjau mengisi seluruh halaman */
            .preview-area {
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;
            }

            /* Atur setiap halaman virtual (.page) */
            .preview-area .page {
                box-shadow: none; /* Hilangkan bayangan */
                margin: 0;
                padding: 0;
                border: none; /* Hilangkan border jika ada */
                width: 100%;
                page-break-after: always; /* Pastikan setiap .page memulai halaman baru */
            }
            
            .page:last-child {
                page-break-after: avoid; /* Halaman terakhir tidak perlu page break setelahnya */
            }

            /* Paksa semua teks menjadi hitam agar konsisten */
            h1, h2, h3, h4, h5, h6, p, td, th, li, a, strong, span {
                color: #000 !important;
            }
            
            /* Pastikan gambar logo tidak pecah dan ukurannya pas */
            .page img {
                max-width: 80px !important; /* Batasi lebar logo */
            }
        }
    </style>

</head>
<body>

    <div id="appdomaindesa">
        <div class="container-fluid my-4">
             <div class="text-center form-area mb-4"><h1>Formulir Permohonan, Kuasa dan SSL Domain Desa</h1></div>
            <div class="row">
                <div class="col-md-4 form-area">
                    <div class="card border-0 shadow mb-4">
                        <div class="card-header"><h5><i class="bi bi-file-earmark-text"></i> Detil Surat</h5></div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Pilih Kecamatan:</label>
                                <select class="form-select" v-model="selectedKecamatanId">
                                    <option disabled value="">Pilih Kecamatan...</option>
                                    <option v-for="kecamatan in allData" :key="kecamatan.idKecamatan" :value="kecamatan.idKecamatan">{{ kecamatan.namaKecamatan }}</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pilih Desa:</label>
                                <select class="form-select" v-model="selectedDesaId" :disabled="!selectedKecamatanId">
                                    <option disabled value="">Pilih Desa...</option>
                                    <option v-for="desa in desaList" :key="desa.idDesa" :value="desa.idDesa">{{ desa.namaDesa }}</option>
                                </select>
                            </div>
                             <div class="mb-3">
                                <label class="form-label">Nama Domain:</label>
                                <input type="text" class="form-control" v-model="letter.domainName" placeholder="Contoh: namadesa.desa.id">
                            </div>
                            <hr>
                            <div class="mb-3"><label class="form-label">Tanggal Surat:</label><input type="date" class="form-control" v-model="letter.date"></div>
                            <div class="mb-3"><label class="form-label">Nomor Surat Permohonan:</label><input type="text" class="form-control" v-model="letter.requestNumber" placeholder="Ketikkan Nomor Surat Permohonan"></div>
                            <div class="mb-3"><label class="form-label">Nomor Surat Kuasa:</label><input type="text" class="form-control" v-model="letter.powerOfAttorneyNumber" placeholder="Ketikkan Nomor Surat Kuasa"></div>
                            <div class="mb-3"><label class="form-label">Nomor Surat SSL:</label><input type="text" class="form-control" v-model="letter.powerOfSslNumber" placeholder="Ketikkan Nomor Surat SSL"></div>
                            <div class="mb-3">
                                <label class="form-label">Alamat Kantor Desa:</label>
                                <textarea class="form-control" v-model="village.address" rows="3" placeholder="Contoh: Jalan Desa No. 1, Kecamatan Mana, Kode Pos 20500"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 shadow mb-4">
                        <div class="card-header"><h5><i class="bi bi-person-check"></i> Penerima Kuasa</h5></div>
                        <div class="card-body">
                            <div class="alert alert-info py-2" role="alert">
                                <small class="fst-italic">Untuk pengisian data penerima kuasa, silahkan berkoordinasi ke Dinas Kominfostan!</small>
                            </div>
                            <div class="mb-3"><label class="form-label">Nama Penerima Kuasa:</label><input type="text" class="form-control" v-model="attorney.name"></div>
                            <div class="mb-3"><label class="form-label">NIP Penerima Kuasa:</label><input type="text" class="form-control" v-model="attorney.nip" @input="handleNumericInput($event, 18)" placeholder="18 digit angka"></div>
                            <div class="mb-3"><label class="form-label">Jabatan Penerima Kuasa:</label><input type="text" class="form-control" v-model="attorney.position"></div>
                            <div class="mb-3"><label class="form-label">Instansi Penerima Kuasa:</label><textarea class="form-control" v-model="attorney.agency" rows="2"></textarea></div>
                            <div class="mb-3"><label class="form-label">Alamat Penerima Kuasa:</label><textarea class="form-control" v-model="attorney.address" rows="2"></textarea></div>
                            <div class="mb-3"><label class="form-label">No. HP Penerima Kuasa:</label><input type="text" class="form-control" v-model="attorney.phone" @input="handleNumericInput($event, 13)" placeholder="10-13 digit angka"></div>
                            <!-- <div class="mb-3"><label class="form-label">Email Penerima Kuasa:</label><input type="email" class="form-control" v-model="attorney.email"></div> -->
                            <label class="form-label">Email Penerima Kuasa:</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" v-model="attorney.email" placeholder="email penerima kuasa" aria-label="email penerima kuasa">
                                <span class="input-group-text" id="basic-addon2">@deliserdangkab.go.id</span>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 shadow mb-4">
                        <div class="card-header"><h5><i class="bi bi-person-check"></i> PIC SSL</h5></div>
                        <div class="card-body">
                            <div class="alert alert-info py-2" role="alert">
                                <small class="fst-italic">Untuk pengisian data PIC SSL, silahkan berkoordinasi ke Dinas Kominfostan!</small>
                            </div>
                            <div class="mb-3"><label class="form-label">Nama PIC SSL:</label><input type="text" class="form-control" v-model="attorneyssl.name"></div>
                            <div class="mb-3"><label class="form-label">No. HP/WA PIC SSL:</label><input type="text" class="form-control" v-model="attorneyssl.phone" @input="handleNumericInput($event, 13)" placeholder="10-13 digit angka"></div>
                        </div>
                    </div>
                </div>

                <div class="col-md-8 preview-area">
                    <div class="mb-4 no-print text-end">
                        <button class="btn btn-outline-primary" @click="window.print()"><i class="bi bi-printer"></i> Cetak</button>
                    </div>
                    
                    <div class="page">
                        <table style="width: 100%; border-bottom: 3px solid black;" class="mb-3">
                            <tr>
                                <td style="width: 10%; text-align: center; vertical-align: middle;"><img :src="letter.logoUrl" alt="Logo" style="width: 80px; height: auto;" class="pb-2"></td>
                                <td class="header-text text-center align-middle pb-2">
                                    <h5 class="">PEMERINTAH KABUPATEN DELI SERDANG</h5>
                                    <h5 class="">KECAMATAN {{ village.kecamatanName.toUpperCase() }}</h5>
                                    <h5 class="fw-semibold">DESA {{ village.name.toUpperCase() }}</h5>
                                    <p class="preserve-lines">{{ village.address }}</p>
                                </td>
                            </tr>
                        </table>
                        <p class="text-end mb-0">{{ village.kecamatanName }}, {{ formattedDate }}</p>
                        <table class="mb-2">
                            <tr><td style="width: 80px;">Nomor</td><td>: {{ letter.requestNumber }}</td></tr>
                            <tr><td>Sifat</td><td>: Penting</td></tr>
                            <tr><td>Lampiran</td><td>: 4 (empat) berkas</td></tr>
                            <tr><td style="vertical-align: top;">Perihal</td><td class="fw-semibold">: Permohonan Pendaftaran Nama Domain</td></tr>
                        </table>
                        <p>Yth.<br>Direktur Jenderal Teknologi Pemerintah Digital<br>Kementerian Komunikasi dan Digital Republik Indonesia<br>di Jakarta</p>
                        <p class="mt-2 mb-0">Dengan hormat,</p>
                        <p class="mb-0" style="text-align: justify;">Dalam rangka meningkatkan layanan informasi dan pelayanan publik melalui internet, kami bermaksud untuk mendaftarkan nama domain dengan rincian sebagai berikut.</p>
                        <table class="letter-table mb-2">
                            <tr><td style="width:150px">Nama Domain</td><td>: {{ letter.domainName }}</td></tr>
                            <tr><td>Nama Instansi</td><td>: Desa {{ village.name }}</td></tr>
                            <tr><td>Alamat</td><td>: <span class="preserve-lines">{{ village.address }}</span></td></tr>
                        </table>
                        <p class="mb-3" style="text-align: justify;">Kami berkomitmen untuk menggunakan nama domain tersebut dengan sebaik-baiknya guna mendukung tugas dan fungsi kami, dan juga memastikan bahwa pengelolaan nama domain akan dilakukan sesuai dengan ketentuan yang berlaku.</p>
                        <p class="mb-0">Sebagai kelengkapan permohonan ini, berikut kami lampirkan:</p>
                        <ol style="padding-left: 1.2rem;">
                            <li>Dokumen legalitas pembentukan pemerintah desa;</li>
                            <li>Surat kuasa dari kepala desa;</li>
                            <li>Surat penunjukan Pejabat Nama Domain;</li>
                            <li>Scan kartu identitas Pejabat Nama Domain (ASN).</li>
                        </ol>
                        <p class="mt-2" style="text-align: justify;">Demikian permohonan ini disampaikan, atas kerjasamanya diucapkan terima kasih.</p>

                        <div class="d-flex justify-content-end mt-0">
                            <div class="col-6"></div>
                            <div class="text-center">
                                <div class="signature-block">
                                    <p>Kepala Desa {{ village.name }}</p>
                                    <div style="height: 70px;"></div>
                                    <p class="fw-bold">{{ village.headName.toUpperCase() }}</p>
                                </div>
                            </div>
                        </div>
                         <div class="">
                            <p class="mb-0"><small>Tembusan:</small></p>
                            <small>Direktur Aplikasi Pemerintah Digital</small>
                        </div>
                    </div>
                    
                    <div class="page">
                         <table style="width: 100%; border-bottom: 3px solid black;" class="mb-3">
                            <tr>
                                <td style="width: 10%; text-align: center; vertical-align: middle;"><img :src="letter.logoUrl" alt="Logo" style="width: 80px; height: auto;" class="pb-2"></td>
                                <td class="header-text text-center align-middle pb-2">
                                    <h5 class="">PEMERINTAH KABUPATEN DELI SERDANG</h5>
                                    <h5 class="">KECAMATAN {{ village.kecamatanName.toUpperCase() }}</h5>
                                    <h5 class="fw-semibold">DESA {{ village.name.toUpperCase() }}</h5>
                                    <p class="preserve-lines">{{ village.address }}</p>
                                </td>
                            </tr>
                        </table>
                         <div class="text-center mb-4 mt-4">
                             <h6 class=" underline">SURAT KUASA</h6>
                             <p>Nomor: {{ letter.powerOfAttorneyNumber }}</p>
                         </div>
                        <p class="mt-4 mb-0">Saya yang bertandatangan di bawah ini:</p>
                        <table class="letter-table mb-3">
                            <tr><td style="width:150px">Nama</td><td>: {{ village.headName }}</td></tr>
                            <tr><td>Jabatan</td><td>: Kepala Desa</td></tr>
                            <tr><td>Instansi</td><td>: Desa {{ village.name }}</td></tr>
                            <tr><td style="vertical-align: top;">Alamat</td><td>: <span class="preserve-lines">{{ village.address }}</span></td></tr>
                        </table>
                        <p class="mb-0">Dengan ini memberikan kuasa kepada,</p>
                        <table class="letter-table mb-3">
                            <tr><td style="width:150px">Nama</td><td>: {{ attorney.name }}</td></tr>
                            <tr><td>NIP</td><td>: {{ formatNipForDisplay(attorney.nip) }}</td></tr>
                            <tr><td>Jabatan</td><td>: {{ attorney.position }}</td></tr>
                            <tr><td style="vertical-align: top;">Instansi</td><td>: <span class="preserve-lines">{{ attorney.agency }}</span></td></tr>
                             <tr><td style="vertical-align: top;">Alamat</td><td>: <span class="preserve-lines">{{ attorney.address }}</span></td></tr>
                            <tr><td>Nomor HP</td><td>: {{ attorney.phone }}</td></tr>
                            <tr><td>e-mail</td><td>: {{ attorney.email }}@deliserdangkab.go.id</td></tr>
                        </table>
                        <p class="mt-3" style="text-align: justify;">Untuk melakukan pendaftaran dan pengelolaan nama domain pemerintah desa: <br> <strong class="">{{ letter.domainName }}</strong></p>
                        <p class="mt-4" style="text-align: justify;">Demikian surat kuasa ini dibuat untuk dipergunakan sebagaimana mestinya.</p>
                        
                        <div class="d-flex justify-content-end mt-5">
                            <div class="col-6"></div>
                            <div class="text-center">
                                 <div class="signature-block">
                                    <p>{{ village.kecamatanName }}, {{ formattedDate }}</p>
                                    <p>Kepala Desa {{ village.name }}</p>
                                    <div style="height: 80px;"></div>
                                    <p class="fw-bold">{{ village.headName.toUpperCase() }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="page">
                        <table style="width: 100%; border-bottom: 3px solid black;" class="mb-3">
                            <tr>
                                <td style="width: 10%; text-align: center; vertical-align: middle;"><img :src="letter.logoUrl" alt="Logo" style="width: 80px; height: auto;" class="pb-2"></td>
                                <td class="header-text text-center align-middle pb-2">
                                    <h5 class="">PEMERINTAH KABUPATEN DELI SERDANG</h5>
                                    <h5 class="">KECAMATAN {{ village.kecamatanName.toUpperCase() }}</h5>
                                    <h5 class="fw-semibold">DESA {{ village.name.toUpperCase() }}</h5>
                                    <p class="preserve-lines">{{ village.address }}</p>
                                </td>
                            </tr>
                        </table>
                        <p class="text-end mb-0">{{ village.kecamatanName }}, {{ formattedDate }}</p>
                        <table class="mb-2">
                            <tr><td style="width: 80px;">Nomor</td><td>: {{ letter.powerOfSslNumber }}</td></tr>
                            <tr><td>Sifat</td><td>: Penting</td></tr>
                            <tr><td>Lampiran</td><td>: -</td></tr>
                            <tr><td style="vertical-align: top;">Perihal</td><td class="fw-semibold">: Permohonan SSL</td></tr>
                        </table>
                        <p>Yth.<br>Direktur Jenderal Teknologi Pemerintah Digital<br>Kementerian Komunikasi dan Digital Republik Indonesia<br>di Jakarta</p>
                        <p class="mt-2 mb-0">Dengan hormat,</p>
                        <p class="mb-0" style="text-align: justify;">Untuk melaksanakan amanat Peraturan Presiden Republik Indonesia Nomor 95 Tahun 2018 Tentang Sistem Pemerintahan Berbasis Elektronik dan menyediakan website desa yang aman dan terpercaya kepada pengguna layanan SPBE, perlu melakukan konfigurasi sertifikat SSL 
                            pada website Desa {{ village.name }}, Kecamatan {{ village.kecamatanName }}, Kabupaten Deli Serdang pada domain {{ letter.domainName }}.
                        </p>
                        <p class="mb-0" style="text-align: justify;">Sehubungan dengan hal tersebut, berikut kelengkapan data untuk keperluan penerbitan SSL dimaksud, diantaranya:
                        </p>
                        <table class="letter-table mb-2">
                            <tr><td style="width:150px">Nama Kabupaten</td><td>: Deli Serdang</td></tr>
                            <tr><td style="width:150px">Nama Kecamatan</td><td>: {{ village.kecamatanName }}</td></tr>
                            <tr><td style="width:150px">Nama Desa</td><td>: {{ village.name }}</td></tr>
                            <tr><td>Alamat url</td><td>: {{ letter.domainName }}</td></tr>
                            <tr><td>Nama PIC</td><td>: {{ attorneyssl.name }}</td></tr>
                            <tr><td>Nomor HP/WA</td><td>: {{ attorneyssl.phone }}</td></tr>
                        </table>

                        <p class="mt-2" style="text-align: justify;">Demikian permohonan ini disampaikan, atas kerjasamanya diucapkan terima kasih.</p>

                        <div class="d-flex justify-content-end mt-0">
                            <div class="col-6"></div>
                            <div class="text-center">
                                <div class="signature-block">
                                    <p>Kepala Desa {{ village.name }}</p>
                                    <div style="height: 70px;"></div>
                                    <p class="fw-bold">{{ village.headName.toUpperCase() }}</p>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    AOS.init();
  </script>

    <script>
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const allData = ref([]);
            const selectedKecamatanId = ref('');
            const selectedDesaId = ref('');

            const letter = reactive({
                date: new Date().toISOString().slice(0, 10),
                requestNumber: '',
                powerOfAttorneyNumber: '',
                powerOfSslNumber: '',
                logoUrl: 'https://portal.deliserdangkab.go.id/wp-content/berkas/1725411853.png',
                domainName: ''
            });

            const village = reactive({
                name: '',
                kecamatanName: '',
                headName: '',
                address: ''
            });
            
            const attorney = reactive({
                name: '',
                nip: '',
                position: '',
                agency: 'Dinas Kominfostan Kabupaten Deli Serdang',
                address: 'Jalan Diponegoro No. 78, Kec. Lubuk Pakam, Kab. Deli Serdang',
                phone: '',
                email: ''
            });

            const attorneyssl = reactive({
                name: '',
                phone: ''
            });

            onMounted(() => {
                axios.get('datakades.json').then(response => {
                    allData.value = response.data;
                }).catch(error => console.error("Gagal memuat data:", error));
            });
            
            const desaList = computed(() => {
                if (!selectedKecamatanId.value) return [];
                const kecamatan = allData.value.find(k => k.idKecamatan === selectedKecamatanId.value);
                return kecamatan ? kecamatan.desa : [];
            });

            watch(selectedKecamatanId, (newId) => {
                selectedDesaId.value = '';
                village.name = '';
                village.headName = '';
                letter.domainName = '';
                const kecamatan = allData.value.find(k => k.idKecamatan === newId);
                village.kecamatanName = kecamatan ? kecamatan.namaKecamatan : '';
            });

            watch(selectedDesaId, (newId) => {
                if (!newId) return;
                const desa = desaList.value.find(d => d.idDesa === newId);
                if (desa) {
                    village.name = desa.namaDesa;
                    village.headName = desa.namaKades;
                    // Auto-generate domain name, but allow user to edit
                    letter.domainName = village.name.toLowerCase().replace(/\s+/g, '').replace(/[^a-z0-9-]/g, '') + '.desa.id';
                }
            });

            const formattedDate = computed(() => {
                if (!letter.date) return '';
                const date = new Date(letter.date);
                date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
                return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            });
            
            const formatNipForDisplay = (nip) => {
                if (!nip || nip.length !== 18) return nip; 
                return `${nip.slice(0, 8)} ${nip.slice(8, 14)} ${nip.slice(14, 15)} ${nip.slice(15, 18)}`;
            };

            const handleNumericInput = (event, maxLength) => {
                let value = event.target.value.replace(/\D/g, '');
                if (maxLength && value.length > maxLength) {
                    value = value.slice(0, maxLength);
                }
                event.target.value = value;
                // Since we are manipulating the value directly, we need to update the model
                if (event.target.id === 'nip') attorney.nip = value;
                if (event.target.id === 'phone') attorney.phone = value;
            };

            return {
                allData,
                selectedKecamatanId,
                selectedDesaId,
                desaList,
                letter,
                village,
                attorney,
                attorneyssl,
                formattedDate,
                formatNipForDisplay,
                handleNumericInput,
                window,
            };
        }
    }).mount('#appdomaindesa');
    </script>

</body>
</html>
